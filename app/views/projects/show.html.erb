
<% @project = Project.find(params[:id]) %>
<% @vols = Volunteer.where(project_id: @project.id)%>
<% if @vols.length == 0 %>
	<% @width = 0 %>
<%else%>
	<%@width = @project.people / @vols.length * 100 %>
<%end%>

<div class="mapPage">
	<div class="row s12" id='projecttitle'><%=@project.name%></div>
	<br>
	<div class="row">
		

		<div class="col s12 m6 l6 "><%=image_tag(@project.photos, width: '70%')%></div>
			<div class="col s12 m6 l6 deets" id='projectdeets'>
			<h4>About this project</h4>
			<p><%=@project.description%></p>
			<br>
			<a class='btn cyan lighten-1'>Volunteer</a>
			<div class="pb">
			<div class="pb-title">Volunteers</div>
			<div>
			<div class="pb-frame" title="$3,000 / 30% towards goal" >
			<div class="pb-fill" style="width:<%=@width%>;">&nbsp;</div>
		</div>
		<span class="pb-caption"><%=@vols.length%></span>
		<span class="pb-caption"><%=@project.people%></span>
	</div>
	<div style="clear: both;"></div>
	<div style="margin: 2px 0 0 0; text-align: right;">
		
	</div>
</div>
			</div>
	</div>

	<div id="map">MAP DIV</div>
</div>



<script type="text/javascript">
				
	var lat;
	var lng;

	geoCode();

	function geoCode(){

		var location = '<%= @project.location %>';
		axios.get('https://maps.googleapis.com/maps/api/geocode/json?', {
			params:{
				address: location,
				key: 'AIzaSyC2RCgQ2GZ4w0zMxOmbC2_fOvQt26wpSSA'
			}
		})
		.then(function(response){
			console.log(response);
			//log full response
			var formattedAddress = response.data.results[0].formatted_address;
			var formattedAddressOutput = `${formattedAddress}`;

			var addressComponents = response.data.results[0].address_components;
			var addressComponentsOutput = '<ul>';
			for(var i = 0; i < addressComponents.length; i++){
				addressComponentsOutput += `${addressComponents[i].types[0]}: ${addressComponents[i].long_name}`;
			}

			lat = response.data.results[0].geometry.location.lat;
			lng = response.data.results[0].geometry.location.lng;
		}).then(function(){
			var map = new google.maps.Map(document.getElementById('map'), {
				center: {lat: lat, lng: lng},
				zoom: 15
			});
		})
		.catch(function(error){
			console.log(error);
		})

	}
			</script>
